if("undefined"==typeof Promise||Promise.prototype.finally||(Promise.prototype.finally=function(e){const t=this.constructor;return this.then((a=>t.resolve(e()).then((()=>a))),(a=>t.resolve(e()).then((()=>{throw a}))))}),"undefined"!=typeof uni&&uni&&uni.requireGlobal){const e=uni.requireGlobal();ArrayBuffer=e.ArrayBuffer,Int8Array=e.Int8Array,Uint8Array=e.Uint8Array,Uint8ClampedArray=e.Uint8ClampedArray,Int16Array=e.Int16Array,Uint16Array=e.Uint16Array,Int32Array=e.Int32Array,Uint32Array=e.Uint32Array,Float32Array=e.Float32Array,Float64Array=e.Float64Array,BigInt64Array=e.BigInt64Array,BigUint64Array=e.BigUint64Array}uni.restoreGlobal&&uni.restoreGlobal(Vue,weex,plus,setTimeout,clearTimeout,setInterval,clearInterval),function(e){"use strict";function t(e,t,...a){uni.__log__?uni.__log__(e,t,...a):console[e].apply(console,[...a,t])}function a(){return"undefined"!=typeof navigator&&"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}}const s="function"==typeof Proxy;class o{constructor(e,t){this.target=null,this.targetQueue=[],this.onQueue=[],this.plugin=e,this.hook=t;const a={};if(e.settings)for(const l in e.settings){const t=e.settings[l];a[l]=t.defaultValue}const s=`__vue-devtools-plugin-settings__${e.id}`;let o={...a};try{const e=localStorage.getItem(s),t=JSON.parse(e);Object.assign(o,t)}catch(n){}this.fallbacks={getSettings:()=>o,setSettings(e){try{localStorage.setItem(s,JSON.stringify(e))}catch(n){}o=e}},t.on("plugin:settings:set",((e,t)=>{e===this.plugin.id&&this.fallbacks.setSettings(t)})),this.proxiedOn=new Proxy({},{get:(e,t)=>this.target?this.target.on[t]:(...e)=>{this.onQueue.push({method:t,args:e})}}),this.proxiedTarget=new Proxy({},{get:(e,t)=>this.target?this.target[t]:"on"===t?this.proxiedOn:Object.keys(this.fallbacks).includes(t)?(...e)=>(this.targetQueue.push({method:t,args:e,resolve:()=>{}}),this.fallbacks[t](...e)):(...e)=>new Promise((a=>{this.targetQueue.push({method:t,args:e,resolve:a})}))})}async setRealTarget(e){this.target=e;for(const t of this.onQueue)this.target.on[t.method](...t.args);for(const t of this.targetQueue)t.resolve(await this.target[t.method](...t.args))}}function n(e,t){const n=a(),l=a().__VUE_DEVTOOLS_GLOBAL_HOOK__,r=s&&e.enableEarlyProxy;if(!l||!n.__VUE_DEVTOOLS_PLUGIN_API_AVAILABLE__&&r){const a=r?new o(e,l):null;(n.__VUE_DEVTOOLS_PLUGINS__=n.__VUE_DEVTOOLS_PLUGINS__||[]).push({pluginDescriptor:e,setupFn:t,proxy:a}),a&&t(a.proxiedTarget)}else l.emit("devtools-plugin:setup",e,t)}
/*!
   * vuex v4.1.0
   * (c) 2022 Evan You
   * @license MIT
   */var l="store";function r(t){return void 0===t&&(t=null),e.inject(null!==t?t:l)}function i(e,t){Object.keys(e).forEach((function(a){return t(e[a],a)}))}function c(e,t,a){return t.indexOf(e)<0&&(a&&a.prepend?t.unshift(e):t.push(e)),function(){var a=t.indexOf(e);a>-1&&t.splice(a,1)}}function u(e,t){e._actions=Object.create(null),e._mutations=Object.create(null),e._wrappedGetters=Object.create(null),e._modulesNamespaceMap=Object.create(null);var a=e.state;m(e,a,[],e._modules.root,!0),d(e,a,t)}function d(t,a,s){var o=t._state,n=t._scope;t.getters={},t._makeLocalGettersCache=Object.create(null);var l=t._wrappedGetters,r={},c={},u=e.effectScope(!0);u.run((function(){i(l,(function(a,s){r[s]=function(e,t){return function(){return e(t)}}(a,t),c[s]=e.computed((function(){return r[s]()})),Object.defineProperty(t.getters,s,{get:function(){return c[s].value},enumerable:!0})}))})),t._state=e.reactive({data:a}),t._scope=u,t.strict&&function(t){e.watch((function(){return t._state.data}),(function(){}),{deep:!0,flush:"sync"})}(t),o&&s&&t._withCommit((function(){o.data=null})),n&&n.stop()}function m(e,t,a,s,o){var n=!a.length,l=e._modules.getNamespace(a);if(s.namespaced&&(e._modulesNamespaceMap[l],e._modulesNamespaceMap[l]=s),!n&&!o){var r=v(t,a.slice(0,-1)),i=a[a.length-1];e._withCommit((function(){r[i]=s.state}))}var c=s.context=function(e,t,a){var s=""===t,o={dispatch:s?e.dispatch:function(a,s,o){var n=h(a,s,o),l=n.payload,r=n.options,i=n.type;return r&&r.root||(i=t+i),e.dispatch(i,l)},commit:s?e.commit:function(a,s,o){var n=h(a,s,o),l=n.payload,r=n.options,i=n.type;r&&r.root||(i=t+i),e.commit(i,l,r)}};return Object.defineProperties(o,{getters:{get:s?function(){return e.getters}:function(){return p(e,t)}},state:{get:function(){return v(e.state,a)}}}),o}(e,l,a);s.forEachMutation((function(t,a){!function(e,t,a,s){(e._mutations[t]||(e._mutations[t]=[])).push((function(t){a.call(e,s.state,t)}))}(e,l+a,t,c)})),s.forEachAction((function(t,a){var s=t.root?a:l+a,o=t.handler||t;!function(e,t,a,s){(e._actions[t]||(e._actions[t]=[])).push((function(t){var o,n=a.call(e,{dispatch:s.dispatch,commit:s.commit,getters:s.getters,state:s.state,rootGetters:e.getters,rootState:e.state},t);return(o=n)&&"function"==typeof o.then||(n=Promise.resolve(n)),e._devtoolHook?n.catch((function(t){throw e._devtoolHook.emit("vuex:error",t),t})):n}))}(e,s,o,c)})),s.forEachGetter((function(t,a){!function(e,t,a,s){if(e._wrappedGetters[t])return;e._wrappedGetters[t]=function(e){return a(s.state,s.getters,e.state,e.getters)}}(e,l+a,t,c)})),s.forEachChild((function(s,n){m(e,t,a.concat(n),s,o)}))}function p(e,t){if(!e._makeLocalGettersCache[t]){var a={},s=t.length;Object.keys(e.getters).forEach((function(o){if(o.slice(0,s)===t){var n=o.slice(s);Object.defineProperty(a,n,{get:function(){return e.getters[o]},enumerable:!0})}})),e._makeLocalGettersCache[t]=a}return e._makeLocalGettersCache[t]}function v(e,t){return t.reduce((function(e,t){return e[t]}),e)}function h(e,t,a){var s;return null!==(s=e)&&"object"==typeof s&&e.type&&(a=t,t=e,e=e.type),{type:e,payload:t,options:a}}var f="vuex:mutations",g="vuex:actions",y="vuex",w=0;function E(e,t){n({id:"org.vuejs.vuex",app:e,label:"Vuex",homepage:"https://next.vuex.vuejs.org/",logo:"https://vuejs.org/images/icons/favicon-96x96.png",packageName:"vuex",componentStateTypes:["vuex bindings"]},(function(a){a.addTimelineLayer({id:f,label:"Vuex Mutations",color:_}),a.addTimelineLayer({id:g,label:"Vuex Actions",color:_}),a.addInspector({id:y,label:"Vuex",icon:"storage",treeFilterPlaceholder:"Filter stores..."}),a.on.getInspectorTree((function(a){if(a.app===e&&a.inspectorId===y)if(a.filter){var s=[];b(s,t._modules.root,a.filter,""),a.rootNodes=s}else a.rootNodes=[x(t._modules.root,"")]})),a.on.getInspectorState((function(a){if(a.app===e&&a.inspectorId===y){var s=a.nodeId;p(t,s),a.state=function(e,t,a){t="root"===a?t:t[a];var s=Object.keys(t),o={state:Object.keys(e.state).map((function(t){return{key:t,editable:!0,value:e.state[t]}}))};if(s.length){var n=function(e){var t={};return Object.keys(e).forEach((function(a){var s=a.split("/");if(s.length>1){var o=t,n=s.pop();s.forEach((function(e){o[e]||(o[e]={_custom:{value:{},display:e,tooltip:"Module",abstract:!0}}),o=o[e]._custom.value})),o[n]=k((function(){return e[a]}))}else t[a]=k((function(){return e[a]}))})),t}(t);o.getters=Object.keys(n).map((function(e){return{key:e.endsWith("/")?N(e):e,editable:!1,value:k((function(){return n[e]}))}}))}return o}((o=t._modules,(l=(n=s).split("/").filter((function(e){return e}))).reduce((function(e,t,a){var s=e[t];if(!s)throw new Error('Missing module "'+t+'" for path "'+n+'".');return a===l.length-1?s:s._children}),"root"===n?o:o.root._children)),"root"===s?t.getters:t._makeLocalGettersCache,s)}var o,n,l})),a.on.editInspectorState((function(a){if(a.app===e&&a.inspectorId===y){var s=a.nodeId,o=a.path;"root"!==s&&(o=s.split("/").filter(Boolean).concat(o)),t._withCommit((function(){a.set(t._state.data,o,a.state.value)}))}})),t.subscribe((function(e,t){var s={};e.payload&&(s.payload=e.payload),s.state=t,a.notifyComponentUpdate(),a.sendInspectorTree(y),a.sendInspectorState(y),a.addTimelineEvent({layerId:f,event:{time:Date.now(),title:e.type,data:s}})})),t.subscribeAction({before:function(e,t){var s={};e.payload&&(s.payload=e.payload),e._id=w++,e._time=Date.now(),s.state=t,a.addTimelineEvent({layerId:g,event:{time:e._time,title:e.type,groupId:e._id,subtitle:"start",data:s}})},after:function(e,t){var s={},o=Date.now()-e._time;s.duration={_custom:{type:"duration",display:o+"ms",tooltip:"Action duration",value:o}},e.payload&&(s.payload=e.payload),s.state=t,a.addTimelineEvent({layerId:g,event:{time:Date.now(),title:e.type,groupId:e._id,subtitle:"end",data:s}})}})}))}var _=8702998,V={label:"namespaced",textColor:16777215,backgroundColor:6710886};function N(e){return e&&"root"!==e?e.split("/").slice(-2,-1)[0]:"Root"}function x(e,t){return{id:t||"root",label:N(t),tags:e.namespaced?[V]:[],children:Object.keys(e._children).map((function(a){return x(e._children[a],t+a+"/")}))}}function b(e,t,a,s){s.includes(a)&&e.push({id:s||"root",label:s.endsWith("/")?s.slice(0,s.length-1):s||"Root",tags:t.namespaced?[V]:[]}),Object.keys(t._children).forEach((function(o){b(e,t._children[o],a,s+o+"/")}))}function k(e){try{return e()}catch(t){return t}}var S=function(e,t){this.runtime=t,this._children=Object.create(null),this._rawModule=e;var a=e.state;this.state=("function"==typeof a?a():a)||{}},C={namespaced:{configurable:!0}};C.namespaced.get=function(){return!!this._rawModule.namespaced},S.prototype.addChild=function(e,t){this._children[e]=t},S.prototype.removeChild=function(e){delete this._children[e]},S.prototype.getChild=function(e){return this._children[e]},S.prototype.hasChild=function(e){return e in this._children},S.prototype.update=function(e){this._rawModule.namespaced=e.namespaced,e.actions&&(this._rawModule.actions=e.actions),e.mutations&&(this._rawModule.mutations=e.mutations),e.getters&&(this._rawModule.getters=e.getters)},S.prototype.forEachChild=function(e){i(this._children,e)},S.prototype.forEachGetter=function(e){this._rawModule.getters&&i(this._rawModule.getters,e)},S.prototype.forEachAction=function(e){this._rawModule.actions&&i(this._rawModule.actions,e)},S.prototype.forEachMutation=function(e){this._rawModule.mutations&&i(this._rawModule.mutations,e)},Object.defineProperties(S.prototype,C);var M=function(e){this.register([],e,!1)};function A(e,t,a){if(t.update(a),a.modules)for(var s in a.modules){if(!t.getChild(s))return;A(e.concat(s),t.getChild(s),a.modules[s])}}M.prototype.get=function(e){return e.reduce((function(e,t){return e.getChild(t)}),this.root)},M.prototype.getNamespace=function(e){var t=this.root;return e.reduce((function(e,a){return e+((t=t.getChild(a)).namespaced?a+"/":"")}),"")},M.prototype.update=function(e){A([],this.root,e)},M.prototype.register=function(e,t,a){var s=this;void 0===a&&(a=!0);var o=new S(t,a);0===e.length?this.root=o:this.get(e.slice(0,-1)).addChild(e[e.length-1],o);t.modules&&i(t.modules,(function(t,o){s.register(e.concat(o),t,a)}))},M.prototype.unregister=function(e){var t=this.get(e.slice(0,-1)),a=e[e.length-1],s=t.getChild(a);s&&s.runtime&&t.removeChild(a)},M.prototype.isRegistered=function(e){var t=this.get(e.slice(0,-1)),a=e[e.length-1];return!!t&&t.hasChild(a)};var B=function(e){var t=this;void 0===e&&(e={});var a=e.plugins;void 0===a&&(a=[]);var s=e.strict;void 0===s&&(s=!1);var o=e.devtools;this._committing=!1,this._actions=Object.create(null),this._actionSubscribers=[],this._mutations=Object.create(null),this._wrappedGetters=Object.create(null),this._modules=new M(e),this._modulesNamespaceMap=Object.create(null),this._subscribers=[],this._makeLocalGettersCache=Object.create(null),this._scope=null,this._devtools=o;var n=this,l=this.dispatch,r=this.commit;this.dispatch=function(e,t){return l.call(n,e,t)},this.commit=function(e,t,a){return r.call(n,e,t,a)},this.strict=s;var i=this._modules.root.state;m(this,i,[],this._modules.root),d(this,i),a.forEach((function(e){return e(t)}))},D={state:{configurable:!0}};B.prototype.install=function(e,t){e.provide(t||l,this),e.config.globalProperties.$store=this,void 0!==this._devtools&&this._devtools&&E(e,this)},D.state.get=function(){return this._state.data},D.state.set=function(e){},B.prototype.commit=function(e,t,a){var s=this,o=h(e,t,a),n=o.type,l=o.payload,r={type:n,payload:l},i=this._mutations[n];i&&(this._withCommit((function(){i.forEach((function(e){e(l)}))})),this._subscribers.slice().forEach((function(e){return e(r,s.state)})))},B.prototype.dispatch=function(e,t){var a=this,s=h(e,t),o=s.type,n=s.payload,l={type:o,payload:n},r=this._actions[o];if(r){try{this._actionSubscribers.slice().filter((function(e){return e.before})).forEach((function(e){return e.before(l,a.state)}))}catch(c){}var i=r.length>1?Promise.all(r.map((function(e){return e(n)}))):r[0](n);return new Promise((function(e,t){i.then((function(t){try{a._actionSubscribers.filter((function(e){return e.after})).forEach((function(e){return e.after(l,a.state)}))}catch(c){}e(t)}),(function(e){try{a._actionSubscribers.filter((function(e){return e.error})).forEach((function(t){return t.error(l,a.state,e)}))}catch(c){}t(e)}))}))}},B.prototype.subscribe=function(e,t){return c(e,this._subscribers,t)},B.prototype.subscribeAction=function(e,t){return c("function"==typeof e?{before:e}:e,this._actionSubscribers,t)},B.prototype.watch=function(t,a,s){var o=this;return e.watch((function(){return t(o.state,o.getters)}),a,Object.assign({},s))},B.prototype.replaceState=function(e){var t=this;this._withCommit((function(){t._state.data=e}))},B.prototype.registerModule=function(e,t,a){void 0===a&&(a={}),"string"==typeof e&&(e=[e]),this._modules.register(e,t),m(this,this.state,e,this._modules.get(e),a.preserveState),d(this,this.state)},B.prototype.unregisterModule=function(e){var t=this;"string"==typeof e&&(e=[e]),this._modules.unregister(e),this._withCommit((function(){delete v(t.state,e.slice(0,-1))[e[e.length-1]]})),u(this)},B.prototype.hasModule=function(e){return"string"==typeof e&&(e=[e]),this._modules.isRegistered(e)},B.prototype.hotUpdate=function(e){this._modules.update(e),u(this,!0)},B.prototype._withCommit=function(e){var t=this._committing;this._committing=!0,e(),this._committing=t},Object.defineProperties(B.prototype,D);const T=e.ref("http://139.196.53.65:10089"),L=async(e,a="GET",s={})=>{const o=`${T.value}${e}`;try{const e={url:o,method:a,timeout:1e5};"GET"===a?e.data=s:(e.data=s,e.header={"Content-Type":"application/x-www-form-urlencoded"});const t=await uni.request(e);if(200===t.statusCode)return t.data;throw new Error(`请求失败，状态码: ${t.statusCode}`)}catch(n){throw t("error","at api/index.js:49","请求出错:",n),n}},R=e=>L("/api/control/relay_status","GET",{device:e}),j=(e,t)=>L("/api/control/set_relay_status","GET",{device:e,status:t}),O=()=>L("/api/control/rules","GET"),I=e=>L("/api/control/set_rules","GET",{rules:e}),q=e=>L("/api/control/add_rules","POST",e),U=()=>L("/api/control/all_plants","GET"),G=e=>L("/api/control/set_mod","GET",{mod:e}),P=()=>L("/api/control/mod","GET"),$=e=>L("/api/control/send_msg","GET",{msg:e}),F=(e,t)=>{const a=e.__vccOpts||e;for(const[s,o]of t)a[s]=o;return a},z=F({__name:"DeviceControl",setup(a){const s=r(),o=e.computed((()=>s.getters.deviceList)),n=e.computed((()=>s.getters.isAutoMode)),l=e.computed((()=>s.state.requestStatus)),i=e.ref(!1),c=e.ref("--:--:--"),u=e.ref(5);let d=null;const m=e=>{switch(e){case"on":return"运行中";case"off":return"已停止";case"null":return"已断连";default:return"未知状态"}},p=async()=>{const e=n.value?"manual":"auto";try{await s.dispatch("setMode",e),await v()}catch(a){t("error","at components/DeviceControl.vue:129","切换模式失败:",a)}},v=async()=>{try{await s.dispatch("fetchAllDevicesStatus",!0),f()}catch(e){t("error","at components/DeviceControl.vue:140","静默获取设备状态失败:",e)}},h=async()=>{i.value=!0;try{await s.dispatch("fetchAllDevicesStatus"),f()}catch(e){t("error","at components/DeviceControl.vue:152","获取设备状态失败:",e)}finally{i.value=!1}},f=()=>{const e=new Date;c.value=`${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}:${e.getSeconds().toString().padStart(2,"0")}`};return e.onMounted((()=>{v(),d=setInterval((()=>{v()}),1e3*u.value)})),e.onUnmounted((()=>{d&&clearInterval(d)})),(a,r)=>(e.openBlock(),e.createElementBlock("view",{class:"device-control"},[e.createElementVNode("view",{class:"panel-header"},[e.createElementVNode("text",{class:"panel-title"},"设备控制"),e.createElementVNode("view",{class:"panel-status"},[e.createElementVNode("text",{class:"status-label"},"当前模式:"),e.createElementVNode("text",{class:e.normalizeClass(["status-value",{"auto-mode":n.value}])},e.toDisplayString(n.value?"自动模式":"手动模式"),3),e.createElementVNode("view",{class:"mode-switch",onClick:p},[e.createElementVNode("view",{class:e.normalizeClass(["switch-track",{"is-auto":n.value}])},[e.createElementVNode("view",{class:"switch-thumb"})],2),e.createElementVNode("text",{class:"switch-text"},e.toDisplayString(n.value?"自动":"手动"),1)])])]),e.createElementVNode("view",{class:"device-status-refresh"},[e.createElementVNode("text",{class:"refresh-text"},"设备状态每 "+e.toDisplayString(u.value)+"s 自动刷新",1),e.createElementVNode("view",{class:"refresh-btn",onClick:h},[e.createElementVNode("view",{class:e.normalizeClass(["refresh-icon",{refreshing:i.value}])},null,2),e.createElementVNode("text",null,"刷新")]),e.createElementVNode("text",{class:"last-updated"},"上次更新: "+e.toDisplayString(c.value),1)]),e.createElementVNode("view",{class:"devices-grid"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.value,(a=>(e.openBlock(),e.createElementBlock("view",{key:a.id,class:e.normalizeClass(["device-item",{"is-on":"on"===a.status,"is-offline":"null"===a.status}])},[e.createElementVNode("view",{class:"device-icon"},[e.createElementVNode("view",{class:e.normalizeClass(["icon-inner",a.id])},["on"===a.status?(e.openBlock(),e.createElementBlock("view",{key:0,class:"icon-animation"})):e.createCommentVNode("",!0)],2)]),e.createElementVNode("view",{class:"device-info"},[e.createElementVNode("text",{class:"device-name"},e.toDisplayString(a.name),1),e.createElementVNode("text",{class:e.normalizeClass(["device-status",{"status-on":"on"===a.status,"status-off":"off"===a.status,"status-offline":"null"===a.status}])},e.toDisplayString(m(a.status)),3)]),e.createElementVNode("view",{class:"device-toggle"},[e.createElementVNode("view",{class:e.normalizeClass(["toggle-track",{"is-on":"on"===a.status}]),onClick:e=>(async e=>{if(n.value||"null"===e.status)return;const a="on"===e.status?"off":"on";try{await s.dispatch("setDeviceStatus",{device:e.id,status:a}),await v()}catch(o){t("error","at components/DeviceControl.vue:117","控制设备失败:",o)}})(a),disabled:n.value||"null"===a.status},[e.createElementVNode("view",{class:"toggle-thumb"})],10,["onClick","disabled"])]),n.value||"null"===a.status?(e.openBlock(),e.createElementBlock("view",{key:0,class:"device-mask"},[e.createElementVNode("text",{class:"mask-text"},e.toDisplayString(n.value?"自动控制中":"设备已断连"),1)])):e.createCommentVNode("",!0)],2)))),128))]),l.value.message?(e.openBlock(),e.createElementBlock("view",{key:0,class:e.normalizeClass(["status-message",{success:l.value.success}])},e.toDisplayString(l.value.message),3)):e.createCommentVNode("",!0)]))}},[["__scopeId","data-v-860729db"]]),H=F({__name:"ModeSwitch",setup(a){const s=r(),o=e.computed((()=>s.state.currentMode)),n=async e=>{if(o.value!==e)try{await s.dispatch("setMode",e)}catch(a){t("error","at components/ModeSwitch.vue:64","切换模式失败:",a)}};return(t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"mode-switch-panel"},[e.createElementVNode("view",{class:"panel-header"},[e.createElementVNode("text",{class:"panel-title"},"运行模式")]),e.createElementVNode("view",{class:"mode-content"},[e.createElementVNode("view",{class:"mode-options"},[e.createElementVNode("view",{class:e.normalizeClass(["mode-option",{active:"auto"===o.value}]),onClick:a[0]||(a[0]=e=>n("auto"))},[e.createElementVNode("view",{class:"option-icon auto-icon"},["auto"===o.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"icon-animation"})):e.createCommentVNode("",!0)]),e.createElementVNode("view",{class:"option-text-container"},[e.createElementVNode("text",{class:"option-text"},"自动模式"),e.createElementVNode("text",{class:"option-desc"},"根据规则自动控制")])],2),e.createElementVNode("view",{class:e.normalizeClass(["mode-option",{active:"manual"===o.value}]),onClick:a[1]||(a[1]=e=>n("manual"))},[e.createElementVNode("view",{class:"option-icon manual-icon"},["manual"===o.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"icon-animation"})):e.createCommentVNode("",!0)]),e.createElementVNode("view",{class:"option-text-container"},[e.createElementVNode("text",{class:"option-text"},"手动模式"),e.createElementVNode("text",{class:"option-desc"},"手动控制每个设备")])],2)]),e.createElementVNode("view",{class:"current-mode"},[e.createElementVNode("text",{class:"mode-label"},"当前模式:"),e.createElementVNode("view",{class:e.normalizeClass(["mode-indicator",{auto:"auto"===o.value}])},[e.createElementVNode("text",{class:"indicator-text"},e.toDisplayString("auto"===o.value?"自动控制":"手动控制"),1)],2)])])]))}},[["__scopeId","data-v-3f8a4a9f"]]),Q=F({__name:"PlantRules",setup(a){const s=r(),o=e.computed((()=>s.state.currentRule)),n=e.computed((()=>s.state.allRules)),l=e.computed((()=>s.getters.isAutoMode)),i=e.ref(!1),c=e.reactive({plants:"",min_soil_humidity:"",max_soil_humidity:"",min_nitrogen:"",max_nitrogen:"",min_phosphorus:"",max_phosphorus:"",min_potassium:"",max_potassium:"",start_time:"",end_time:""}),u=async()=>{const e=["plants","min_soil_humidity","max_soil_humidity","min_nitrogen","max_nitrogen","min_phosphorus","max_phosphorus","min_potassium","max_potassium","start_time","end_time"];for(const t of e)if(!c[t])return void uni.showToast({title:"请填写所有必填项",icon:"none"});const a={...c,min_soil_humidity:Number(c.min_soil_humidity),max_soil_humidity:Number(c.max_soil_humidity),min_nitrogen:Number(c.min_nitrogen),max_nitrogen:Number(c.max_nitrogen),min_phosphorus:Number(c.min_phosphorus),max_phosphorus:Number(c.max_phosphorus),min_potassium:Number(c.min_potassium),max_potassium:Number(c.max_potassium)};try{0===(await s.dispatch("addRule",a)).code&&(Object.keys(c).forEach((e=>{c[e]=""})),i.value=!1,uni.showToast({title:"规则添加成功",icon:"success"}))}catch(o){t("error","at components/PlantRules.vue:263","添加规则失败:",o)}};return e.watch(l,(e=>{e||uni.showToast({title:"手动模式下无法选择植物规则",icon:"none",duration:2e3})})),(a,r)=>(e.openBlock(),e.createElementBlock("view",{class:"plant-rules"},[e.createElementVNode("view",{class:"panel-header"},[e.createElementVNode("text",{class:"panel-title"},"种植物规则"),e.createElementVNode("button",{class:"add-rule-btn",onClick:r[0]||(r[0]=e=>i.value=!0)},[e.createElementVNode("view",{class:"btn-icon-plus"}),e.createElementVNode("text",null,"添加")])]),e.createElementVNode("scroll-view",{"scroll-y":"",class:"rules-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.value,(a=>(e.openBlock(),e.createElementBlock("view",{key:a.id,class:e.normalizeClass(["rule-item",{active:a.plants===o.value}]),onClick:e=>(async e=>{if(e!==o.value)if(l.value)try{await s.dispatch("setRule",e)}catch(a){t("error","at components/PlantRules.vue:211","设置规则失败:",a)}else uni.showToast({title:"请先切换到自动模式",icon:"none"})})(a.plants)},[e.createElementVNode("view",{class:"rule-header"},[e.createElementVNode("view",{class:"rule-name-area"},[e.createElementVNode("text",{class:"rule-name"},e.toDisplayString(a.plants),1),a.plants===o.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"rule-badge"},"当前")):e.createCommentVNode("",!0)]),a.plants!==o.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"rule-select"},"选择")):e.createCommentVNode("",!0)]),e.createElementVNode("view",{class:"rule-grid"},[e.createElementVNode("view",{class:"rule-param"},[e.createElementVNode("view",{class:"param-icon humidity"}),e.createElementVNode("view",{class:"param-info"},[e.createElementVNode("text",{class:"param-label"},"湿度范围"),e.createElementVNode("text",{class:"param-value"},e.toDisplayString(a.min_soil_humidity)+"% - "+e.toDisplayString(a.max_soil_humidity)+"%",1)])]),e.createElementVNode("view",{class:"rule-param"},[e.createElementVNode("view",{class:"param-icon time"}),e.createElementVNode("view",{class:"param-info"},[e.createElementVNode("text",{class:"param-label"},"运行时间"),e.createElementVNode("text",{class:"param-value"},e.toDisplayString(a.start_time)+" - "+e.toDisplayString(a.end_time),1)])]),e.createElementVNode("view",{class:"rule-param"},[e.createElementVNode("view",{class:"param-icon nitrogen"}),e.createElementVNode("view",{class:"param-info"},[e.createElementVNode("text",{class:"param-label"},"氮含量"),e.createElementVNode("text",{class:"param-value"},e.toDisplayString(a.min_nitrogen)+" - "+e.toDisplayString(a.max_nitrogen),1)])]),e.createElementVNode("view",{class:"rule-param"},[e.createElementVNode("view",{class:"param-icon phosphorus"}),e.createElementVNode("view",{class:"param-info"},[e.createElementVNode("text",{class:"param-label"},"磷含量"),e.createElementVNode("text",{class:"param-value"},e.toDisplayString(a.min_phosphorus)+" - "+e.toDisplayString(a.max_phosphorus),1)])]),e.createElementVNode("view",{class:"rule-param"},[e.createElementVNode("view",{class:"param-icon potassium"}),e.createElementVNode("view",{class:"param-info"},[e.createElementVNode("text",{class:"param-label"},"钾含量"),e.createElementVNode("text",{class:"param-value"},e.toDisplayString(a.min_potassium)+" - "+e.toDisplayString(a.max_potassium),1)])])])],10,["onClick"])))),128)),0===n.value.length?(e.openBlock(),e.createElementBlock("view",{key:0,class:"no-rules"},[e.createElementVNode("view",{class:"empty-icon"}),e.createElementVNode("text",{class:"empty-text"},"暂无植物规则"),e.createElementVNode("text",{class:"empty-subtext"},"点击右上角添加规则按钮创建新规则")])):e.createCommentVNode("",!0)]),i.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"modal-overlay",onClick:r[15]||(r[15]=e=>i.value=!1)},[e.createElementVNode("view",{class:"modal-content",onClick:r[14]||(r[14]=e.withModifiers((()=>{}),["stop"]))},[e.createElementVNode("view",{class:"modal-header"},[e.createElementVNode("text",{class:"modal-title"},"添加新规则"),e.createElementVNode("view",{class:"modal-close",onClick:r[1]||(r[1]=e=>i.value=!1)},"✕")]),e.createElementVNode("scroll-view",{"scroll-y":"",class:"modal-body"},[e.createElementVNode("view",{class:"form-group"},[e.createElementVNode("text",{class:"form-label required"},"种植物名称"),e.withDirectives(e.createElementVNode("input",{class:"form-input","onUpdate:modelValue":r[2]||(r[2]=e=>c.plants=e),placeholder:"请输入种植物名称"},null,512),[[e.vModelText,c.plants]])]),e.createElementVNode("view",{class:"form-section"},[e.createElementVNode("text",{class:"section-title"},"湿度设置"),e.createElementVNode("view",{class:"form-row"},[e.createElementVNode("view",{class:"form-group half"},[e.createElementVNode("text",{class:"form-label required"},"最低湿度(%)"),e.withDirectives(e.createElementVNode("input",{class:"form-input",type:"digit","onUpdate:modelValue":r[3]||(r[3]=e=>c.min_soil_humidity=e),placeholder:"60"},null,512),[[e.vModelText,c.min_soil_humidity]])]),e.createElementVNode("view",{class:"form-group half"},[e.createElementVNode("text",{class:"form-label required"},"最高湿度(%)"),e.withDirectives(e.createElementVNode("input",{class:"form-input",type:"digit","onUpdate:modelValue":r[4]||(r[4]=e=>c.max_soil_humidity=e),placeholder:"80"},null,512),[[e.vModelText,c.max_soil_humidity]])])])]),e.createElementVNode("view",{class:"form-section"},[e.createElementVNode("text",{class:"section-title"},"养分含量设置"),e.createElementVNode("view",{class:"form-row"},[e.createElementVNode("view",{class:"form-group half"},[e.createElementVNode("text",{class:"form-label required"},"最低氮含量"),e.withDirectives(e.createElementVNode("input",{class:"form-input",type:"digit","onUpdate:modelValue":r[5]||(r[5]=e=>c.min_nitrogen=e),placeholder:"1000"},null,512),[[e.vModelText,c.min_nitrogen]])]),e.createElementVNode("view",{class:"form-group half"},[e.createElementVNode("text",{class:"form-label required"},"最高氮含量"),e.withDirectives(e.createElementVNode("input",{class:"form-input",type:"digit","onUpdate:modelValue":r[6]||(r[6]=e=>c.max_nitrogen=e),placeholder:"2000"},null,512),[[e.vModelText,c.max_nitrogen]])])]),e.createElementVNode("view",{class:"form-row"},[e.createElementVNode("view",{class:"form-group half"},[e.createElementVNode("text",{class:"form-label required"},"最低磷含量"),e.withDirectives(e.createElementVNode("input",{class:"form-input",type:"digit","onUpdate:modelValue":r[7]||(r[7]=e=>c.min_phosphorus=e),placeholder:"500"},null,512),[[e.vModelText,c.min_phosphorus]])]),e.createElementVNode("view",{class:"form-group half"},[e.createElementVNode("text",{class:"form-label required"},"最高磷含量"),e.withDirectives(e.createElementVNode("input",{class:"form-input",type:"digit","onUpdate:modelValue":r[8]||(r[8]=e=>c.max_phosphorus=e),placeholder:"1000"},null,512),[[e.vModelText,c.max_phosphorus]])])]),e.createElementVNode("view",{class:"form-row"},[e.createElementVNode("view",{class:"form-group half"},[e.createElementVNode("text",{class:"form-label required"},"最低钾含量"),e.withDirectives(e.createElementVNode("input",{class:"form-input",type:"digit","onUpdate:modelValue":r[9]||(r[9]=e=>c.min_potassium=e),placeholder:"800"},null,512),[[e.vModelText,c.min_potassium]])]),e.createElementVNode("view",{class:"form-group half"},[e.createElementVNode("text",{class:"form-label required"},"最高钾含量"),e.withDirectives(e.createElementVNode("input",{class:"form-input",type:"digit","onUpdate:modelValue":r[10]||(r[10]=e=>c.max_potassium=e),placeholder:"1500"},null,512),[[e.vModelText,c.max_potassium]])])])]),e.createElementVNode("view",{class:"form-section"},[e.createElementVNode("text",{class:"section-title"},"运行时间设置"),e.createElementVNode("view",{class:"form-row"},[e.createElementVNode("view",{class:"form-group half"},[e.createElementVNode("text",{class:"form-label required"},"开始时间"),e.withDirectives(e.createElementVNode("input",{class:"form-input","onUpdate:modelValue":r[11]||(r[11]=e=>c.start_time=e),placeholder:"8:30"},null,512),[[e.vModelText,c.start_time]])]),e.createElementVNode("view",{class:"form-group half"},[e.createElementVNode("text",{class:"form-label required"},"结束时间"),e.withDirectives(e.createElementVNode("input",{class:"form-input","onUpdate:modelValue":r[12]||(r[12]=e=>c.end_time=e),placeholder:"17:30"},null,512),[[e.vModelText,c.end_time]])])])])]),e.createElementVNode("view",{class:"modal-footer"},[e.createElementVNode("button",{class:"form-btn cancel",onClick:r[13]||(r[13]=e=>i.value=!1)},"取消"),e.createElementVNode("button",{class:"form-btn submit",onClick:u},"添加规则")])])])):e.createCommentVNode("",!0)]))}},[["__scopeId","data-v-33d2f7d2"]]),W=F({__name:"VoiceAssistant",setup(a){const s=r(),o=e.computed((()=>s.state.chatMessages)),n=e.ref(""),l=e.ref(!1),i=e.ref(!1),c=e.ref(0),u=e.ref(null),d=e=>{if(!e)return"";try{if(e.includes(":")){const t=e.split(":");return t.length>=3?`${t[0]}:${t[1]}:${t[2].substring(0,2)}`:e}return new Date(e).toTimeString().substring(0,8)}catch(t){return e}},m=async()=>{if(n.value.trim()&&!l.value)try{i.value=!0,await s.dispatch("sendAIMessage",n.value),n.value="",setTimeout((()=>{i.value=!1,e.nextTick((()=>{f()}))}),500)}catch(a){t("error","at components/VoiceAssistant.vue:160","发送消息失败:",a),i.value=!1}};let p=null;const v=()=>{l.value=!0,p=setTimeout((()=>{h()}),1e4)},h=()=>{if(p&&(clearTimeout(p),p=null),!l.value)return;l.value=!1;const e=["打开水泵","关闭所有设备","切换到自动模式","查询当前状态","使用苹果的种植规则"],t=e[Math.floor(Math.random()*e.length)];n.value=t,setTimeout(m,300)},f=()=>{c.value=999999,setTimeout((()=>{c.value=999999}),100)},g=()=>{t("log","at components/VoiceAssistant.vue:222","加载更多消息")};return e.watch(o,(()=>{e.nextTick((()=>{f()}))})),e.onMounted((()=>{o.value.length>0&&e.nextTick((()=>{f()}))})),(t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"voice-assistant"},[e.createElementVNode("view",{class:"panel-header"},[e.createElementVNode("text",{class:"panel-title"},"语音助手"),e.createElementVNode("view",{class:e.normalizeClass(["assistant-status",{active:l.value}])},[e.createElementVNode("view",{class:"status-dot"}),e.createElementVNode("text",{class:"status-text"},e.toDisplayString(l.value?"正在聆听...":"待命中"),1)],2)]),e.createElementVNode("view",{class:"chat-container"},[e.createElementVNode("scroll-view",{"scroll-y":"",class:"chat-messages","scroll-top":c.value,onScrolltoupper:g,ref_key:"messagesScroll",ref:u,"enable-flex":""},[e.createElementVNode("view",{class:"scroll-content"},[0===o.value.length?(e.openBlock(),e.createElementBlock("view",{key:0,class:"empty-state"},[e.createElementVNode("view",{class:"empty-icon"}),e.createElementVNode("text",{class:"empty-text"},"您可以通过语音或文字与我交流"),e.createElementVNode("view",{class:"examples"},[e.createElementVNode("text",{class:"example-title"},"您可以尝试:"),e.createElementVNode("view",{class:"example-item"},[e.createElementVNode("view",{class:"example-bullet"}),e.createElementVNode("text",{class:"example-text"},'"打开水泵"')]),e.createElementVNode("view",{class:"example-item"},[e.createElementVNode("view",{class:"example-bullet"}),e.createElementVNode("text",{class:"example-text"},'"关闭所有设备"')]),e.createElementVNode("view",{class:"example-item"},[e.createElementVNode("view",{class:"example-bullet"}),e.createElementVNode("text",{class:"example-text"},'"切换到自动模式"')])])])):(e.openBlock(),e.createElementBlock("view",{key:1,class:"messages-container"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:e.normalizeClass(["message-item",{user:"user"===t.role,assistant:"assistant"===t.role,system:"system"===t.role}])},[e.createElementVNode("view",{class:e.normalizeClass(["message-avatar",t.role])},[e.createElementVNode("view",{class:"avatar-icon"})],2),e.createElementVNode("view",{class:"message-content"},[e.createElementVNode("view",{class:"message-bubble"},e.toDisplayString(t.content),1),e.createElementVNode("text",{class:"message-time"},e.toDisplayString(d(t.time)),1)])],2)))),128)),i.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"typing-indicator"},[e.createElementVNode("view",{class:"typing-dot"}),e.createElementVNode("view",{class:"typing-dot"}),e.createElementVNode("view",{class:"typing-dot"})])):e.createCommentVNode("",!0)]))])],40,["scroll-top"])]),e.createElementVNode("view",{class:"chat-input-container"},[e.createElementVNode("view",{class:"input-wrapper"},[e.withDirectives(e.createElementVNode("input",{class:"text-input",type:"text","onUpdate:modelValue":a[0]||(a[0]=e=>n.value=e),placeholder:"请输入您的问题...",onConfirm:m,disabled:l.value,"adjust-position":"false"},null,40,["disabled"]),[[e.vModelText,n.value]])]),e.createElementVNode("view",{class:e.normalizeClass(["voice-btn",{listening:l.value}]),onTouchstart:v,onTouchend:h},[e.createElementVNode("view",{class:"voice-icon"}),l.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"voice-waves"},[(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList(3,((t,a)=>e.createElementVNode("view",{key:a,class:"wave"}))),64))])):e.createCommentVNode("",!0)],34),e.createElementVNode("button",{class:"send-btn",disabled:!n.value||l.value,onClick:m},[e.createElementVNode("view",{class:"send-icon"})],8,["disabled"])])]))}},[["__scopeId","data-v-9852b2e1"]]),J=F({__name:"Loading",props:{show:{type:Boolean,default:!1},text:{type:String,default:""}},setup:t=>(a,s)=>t.show?(e.openBlock(),e.createElementBlock("view",{key:0,class:"loading-container"},[e.createElementVNode("view",{class:"loading-overlay"}),e.createElementVNode("view",{class:"loading-content"},[e.createElementVNode("view",{class:"loading-spinner"},[(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList(4,((t,a)=>e.createElementVNode("view",{key:a,class:e.normalizeClass(["spinner-item",`delay-${a}`])},null,2))),64))]),e.createElementVNode("text",{class:"loading-text"},e.toDisplayString(t.text||"加载中..."),1)])])):e.createCommentVNode("",!0)},[["__scopeId","data-v-c0d7a97a"]]);__definePage("pages/index/index",{__name:"index",setup(t){const a=r(),s=e.computed((()=>a.getters.isAutoMode)),o=e.computed((()=>a.state.currentRule)),n=e.computed((()=>a.state.loading)),l=e.ref(!1),i=e.ref(""),c=()=>{var e;i.value?(e=i.value,T.value=e,uni.showToast({title:"服务器地址已更新",icon:"success"}),l.value=!1,a.dispatch("initApp")):uni.showToast({title:"请输入有效地址",icon:"none"})};return e.onMounted((()=>{i.value=T.value,a.dispatch("initApp"),"android"===uni.getSystemInfoSync().platform&&setTimeout((()=>{"undefined"!=typeof plus&&plus.navigator&&plus.navigator.setFullscreen(!0)}),1e3)})),(t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:"header"},[e.createElementVNode("view",{class:"app-info"},[e.createElementVNode("text",{class:"app-title"},"开源节流-智能灌溉控制系统"),e.createElementVNode("text",{class:"app-subtitle"},"MYL")]),e.createElementVNode("view",{class:"status-bar"},[e.createElementVNode("view",{class:"status-item"},[e.createElementVNode("text",{class:"status-label"},"模式"),e.createElementVNode("text",{class:e.normalizeClass(["status-value",{auto:s.value}])},e.toDisplayString(s.value?"自动":"手动"),3)]),e.createElementVNode("view",{class:"status-item"},[e.createElementVNode("text",{class:"status-label"},"当前规则"),e.createElementVNode("text",{class:"status-value rule"},e.toDisplayString(o.value||"未设置"),1)]),e.createElementVNode("view",{class:"status-item settings"},[e.createElementVNode("view",{class:"setting-btn",onClick:a[0]||(a[0]=e=>l.value=!0)},[e.createElementVNode("view",{class:"setting-icon ip"}),e.createElementVNode("text",null,"修改IP")])])])]),e.createElementVNode("view",{class:"main-content"},[e.createElementVNode("view",{class:"left-panel"},[e.createVNode(W)]),e.createElementVNode("view",{class:"center-panel"},[e.createVNode(z)]),e.createElementVNode("view",{class:"right-panel"},[e.createElementVNode("view",{class:"top-section"},[e.createVNode(H)]),e.createElementVNode("view",{class:"bottom-section"},[e.createVNode(Q)])])]),l.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"dialog-overlay",onClick:a[4]||(a[4]=e=>l.value=!1)},[e.createElementVNode("view",{class:"dialog-content",onClick:a[3]||(a[3]=e.withModifiers((()=>{}),["stop"]))},[e.createElementVNode("text",{class:"dialog-title"},"修改服务器地址"),e.withDirectives(e.createElementVNode("input",{class:"dialog-input",type:"text","onUpdate:modelValue":a[1]||(a[1]=e=>i.value=e),placeholder:"请输入新的服务器地址"},null,512),[[e.vModelText,i.value]]),e.createElementVNode("view",{class:"dialog-actions"},[e.createElementVNode("button",{class:"dialog-btn cancel",onClick:a[2]||(a[2]=e=>l.value=!1)},"取消"),e.createElementVNode("button",{class:"dialog-btn confirm",onClick:c},"确认")])])])):e.createCommentVNode("",!0),e.createVNode(J,{show:n.value},null,8,["show"])]))}});const K={onLaunch:function(){t("log","at App.vue:4","App Launch"),this.setFullScreen()},onShow:function(){t("log","at App.vue:11","App Show"),this.setFullScreen()},onHide:function(){t("log","at App.vue:18","App Hide")},methods:{setFullScreen(){setTimeout((()=>{if("undefined"!=typeof plus)try{plus.screen.lockOrientation("landscape"),plus.navigator.setFullscreen(!0);const e=plus.webview.currentWebview();if(e.setStyle({position:"absolute",top:"0px",bottom:"0px",left:"0px",right:"0px",background:"#051020",popGesture:"none",scrollIndicator:"none",softinputMode:"adjustResize"}),plus.navigator.setStatusBarBackground("#000000"),plus.navigator.setStatusBarStyle("dark"),plus.navigator.setFullscreen(!0),"android"===plus.os.name.toLowerCase()){plus.android.importClass("android.content.Context");const e=plus.android.runtimeMainActivity().getWindow(),t=(plus.android.importClass("android.view.View"),1024);e.setFlags(t,t);const a=e.getDecorView(),s=2|4|4096|256|512|1024;a.setSystemUiVisibility(s)}else if("ios"===plus.os.name.toLowerCase()){const t=plus.navigator.getStatusbarHeight();e.setStyle({top:-t+"px",bottom:"0px"})}}catch(e){t("error","at App.vue:94","设置全屏失败:",e.message)}}),300)}}},Y=new B({state:{devices:{pump:"off",nitrogen:"off",phosphorus:"off",potassium:"off"},currentMode:"manual",currentRule:"",allRules:[],loading:!1,chatMessages:[],requestStatus:{success:!1,message:""}},mutations:{updateDeviceStatus(e,{device:t,status:a}){e.devices[t]=a},updateCurrentMode(e,t){e.currentMode=t},updateCurrentRule(e,t){e.currentRule=t},updateAllRules(e,t){e.allRules=t},setLoading(e,t){e.loading=t},addChatMessage(e,{role:t,content:a}){e.chatMessages.push({role:t,content:a,time:(new Date).toLocaleTimeString()})},updateRequestStatus(e,{success:t,message:a}){e.requestStatus={success:t,message:a},setTimeout((()=>{e.requestStatus={success:!1,message:""}}),3e3)}},actions:{async initApp({dispatch:e}){await e("fetchCurrentMode"),await e("fetchAllDevicesStatus"),await e("fetchCurrentRule"),await e("fetchAllRules")},async fetchAllDevicesStatus({commit:e},a=!1){a||e("setLoading",!0);try{const t=["pump","nitrogen","phosphorus","potassium"];for(const a of t){const t=await R(a);0===t.code&&e("updateDeviceStatus",{device:a,status:t.data.status})}}catch(s){t("error","at store/index.js:90","获取设备状态失败",s),a||e("updateRequestStatus",{success:!1,message:"获取设备状态失败"})}finally{a||e("setLoading",!1)}},async fetchDeviceStatus({commit:e},{device:a,silent:s=!1}){s||e("setLoading",!0);try{const t=await R(a);return 0===t.code&&e("updateDeviceStatus",{device:a,status:t.data.status}),t}catch(o){throw t("error","at store/index.js:114",`获取${a}状态失败`,o),s||e("updateRequestStatus",{success:!1,message:`获取${a}状态失败`}),o}finally{s||e("setLoading",!1)}},async setDeviceStatus({commit:e,state:a},{device:s,status:o}){if("auto"!==a.currentMode){e("setLoading",!0);try{const t=await j(s,o);if(0===t.code){let a=!1,n="";"on"!==o||1!==t.data.set_on&&2!==t.data.set_on?"off"!==o||1!==t.data.set_off&&2!==t.data.set_off?n="设置失败":(a=!0,n=2===t.data.set_off?"设备已处于关闭状态":"设备关闭成功",e("updateDeviceStatus",{device:s,status:"off"})):(a=!0,n=2===t.data.set_on?"设备已处于开启状态":"设备开启成功",e("updateDeviceStatus",{device:s,status:"on"})),e("updateRequestStatus",{success:a,message:n})}else e("updateRequestStatus",{success:!1,message:t.message||"设置失败"});return t}catch(n){throw t("error","at store/index.js:161",`设置${s}状态失败`,n),e("updateRequestStatus",{success:!1,message:`设置${s}状态失败`}),n}finally{e("setLoading",!1)}}else e("updateRequestStatus",{success:!1,message:"自动模式下无法手动控制设备"})},async fetchCurrentMode({commit:e},a=!1){a||e("setLoading",!0);try{const t=await P();return 0===t.code&&e("updateCurrentMode",t.data.mod),t}catch(s){throw t("error","at store/index.js:182","获取当前模式失败",s),a||e("updateRequestStatus",{success:!1,message:"获取当前模式失败"}),s}finally{a||e("setLoading",!1)}},async setMode({commit:e},a){e("setLoading",!0);try{const t=await G(a);if(0===t.code){let s=!1,o="";1===t.data.setMod||2===t.data.setMod?(s=!0,o=2===t.data.setMod?`已处于${"auto"===a?"自动":"手动"}模式`:`切换到${"auto"===a?"自动":"手动"}模式成功`,e("updateCurrentMode",a)):o="模式设置失败",e("updateRequestStatus",{success:s,message:o})}else e("updateRequestStatus",{success:!1,message:t.message||"模式设置失败"});return t}catch(s){throw t("error","at store/index.js:218","设置模式失败",s),e("updateRequestStatus",{success:!1,message:"设置模式失败"}),s}finally{e("setLoading",!1)}},async fetchCurrentRule({commit:e},a=!1){a||e("setLoading",!0);try{const t=await O();return 0===t.code&&e("updateCurrentRule",t.data.rules),t}catch(s){throw t("error","at store/index.js:239","获取当前规则失败",s),a||e("updateRequestStatus",{success:!1,message:"获取当前规则失败"}),s}finally{a||e("setLoading",!1)}},async setRule({commit:e},a){e("setLoading",!0);try{const t=await I(a);if(0===t.code){let s=!1,o="";1===t.data.setRules||2===t.data.setRules?(s=!0,o=2===t.data.setRules?`已使用"${a}"规则`:`切换到"${a}"规则成功`,e("updateCurrentRule",a)):o="规则设置失败",e("updateRequestStatus",{success:s,message:o})}else e("updateRequestStatus",{success:!1,message:t.message||"规则设置失败"});return t}catch(s){throw t("error","at store/index.js:275","设置规则失败",s),e("updateRequestStatus",{success:!1,message:"设置规则失败"}),s}finally{e("setLoading",!1)}},async fetchAllRules({commit:e},a=!1){a||e("setLoading",!0);try{const t=await U();return 0===t.code&&e("updateAllRules",t.data),t}catch(s){throw t("error","at store/index.js:296","获取所有规则失败",s),a||e("updateRequestStatus",{success:!1,message:"获取所有规则失败"}),s}finally{a||e("setLoading",!1)}},async addRule({commit:e,dispatch:a},s){e("setLoading",!0);try{const t=await q(s);if(0===t.code)e("updateRequestStatus",{success:!0,message:"添加规则成功"}),await a("fetchAllRules");else{let a="添加规则失败";2===t.code?a="该植物规则已存在":3===t.code&&(a="起始时间不能大于结束时间"),e("updateRequestStatus",{success:!1,message:a})}return t}catch(o){throw t("error","at store/index.js:329","添加规则失败",o),e("updateRequestStatus",{success:!1,message:"添加规则失败"}),o}finally{e("setLoading",!1)}},async sendAIMessage({commit:e},a){e("addChatMessage",{role:"user",content:a}),e("setLoading",!0);try{const t=await $(a);if(0===t.code){e("addChatMessage",{role:"assistant",content:t.data.content});try{const a=t.data.content,s=JSON.parse(a);if("set_device_status"===s.function_name){const{device:t,status:a}=s.parameters;Array.isArray(t)?e("addChatMessage",{role:"system",content:`正在执行批量${"on"===a?"开启":"关闭"}设备操作...`}):e("addChatMessage",{role:"system",content:`正在${"on"===a?"开启":"关闭"}${t}...`})}}catch(s){}}else e("updateRequestStatus",{success:!1,message:"发送消息失败"});return t}catch(o){throw t("error","at store/index.js:380","发送消息失败",o),e("updateRequestStatus",{success:!1,message:"发送消息失败"}),o}finally{e("setLoading",!1)}}},getters:{isAutoMode:e=>"auto"===e.currentMode,deviceList:e=>Object.entries(e.devices).map((([e,t])=>({id:e,name:{pump:"水泵",nitrogen:"氮肥",phosphorus:"磷肥",potassium:"钾肥"}[e],status:t})))}});const{app:X,Vuex:Z,Pinia:ee}=function(){const a=e.createVueApp(K);return a.use(Y),a.config.globalProperties.$autoAdjustStatusBar=!1,a.config.errorHandler=(e,a,s)=>{t("error","at main.js:16","应用错误:",e,s)},a.config.globalProperties.$setFullScreen=()=>{if("undefined"!=typeof plus){plus.navigator.setFullscreen(!0);const a=plus.webview.currentWebview();if(a&&a.setStyle({popGesture:"none",background:"#051020"}),"android"===plus.os.name.toLowerCase())try{const e=plus.android.runtimeMainActivity().getWindow(),t=(plus.android.importClass("android.view.View"),e.getDecorView()),a=5894;t.setSystemUiVisibility(a)}catch(e){t("error","at main.js:50","Android全屏设置失败:",e)}}},{app:a}}();uni.Vuex=Z,uni.Pinia=ee,X.provide("__globalStyles",__uniConfig.styles),X._component.mpType="app",X._component.render=()=>{},X.mount("#app")}(Vue);
